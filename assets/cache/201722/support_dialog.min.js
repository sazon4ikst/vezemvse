$(".drawer__support-phone").click(function() {
	$(".drawer__close").click();
		
	openSupportDialog();
});

$(".x-open-support-box").click(function() {
	openSupportDialog();
});

$(".header__support-phone").click(function() {
	openSupportDialog();
});

$("#x-support-dialog .close").click(function() {
	closeSupportDialog();
});

$(".x-backdrop").click(function() {
	closeSupportDialog();
});

function openSupportDialog(){
	$("#x-support-dialog").removeClass("fade hidden");
	$(".x-backdrop").show();
}

function closeSupportDialog(){
	$("#x-support-dialog").addClass("fade hidden");
	$(".x-backdrop").hide();
	$(".x-success-message").css("display", "none");
	
	$("#support_email").val("");
	$("#support_message").val("");
}

$("#support_send_button").click(function() {	
	var email = $("#support_email").val();
	var message = $("#support_message").val();
	
	if (email=="" || message=="") {
		alert("Пожалуйста заполните все поля.");
		return;
	}
	
	$("#support_send_button").text("Подождите...");
	
	$.ajax({
		type: "POST",
		url: '../api/support/send_support_email',
		data: {
			"email": email,
			"message": message
		},
		dataType: "json",
		success: function(data){
			$("#support_send_button").text("Отправить сообщение");
			setMessageSent();
		},
		error: function(data){
			alert("Произошла ошибка. "+JSON.stringify(data));
			$("#support_send_button").text("Отправить сообщение");
		}
	});
});

function setMessageSent(){
	$(".x-success-message").css("display", "block");
	
	$("#support_email").val("");
	$("#support_message").val("");
}
