!function(a){function b(a){return"object"==typeof a?a:{top:a,left:a}}var c=a.scrollTo=function(b,c,d){a(window).scrollTo(b,c,d)};c.defaults={axis:"xy",duration:parseFloat(a.fn.jquery)>=1.3?0:1},c.window=function(b){return a(window)._scrollable()},a.fn._scrollable=function(){return this.map(function(){var b=this,c=!b.nodeName||-1!=a.inArray(b.nodeName.toLowerCase(),["iframe","#document","html","body"]);if(!c)return b;var d=(b.contentWindow||b).document||b.ownerDocument||b;return a.browser.safari||"BackCompat"==d.compatMode?d.body:d.documentElement})},a.fn.scrollTo=function(d,e,f){return"object"==typeof e&&(f=e,e=0),"function"==typeof f&&(f={onAfter:f}),"max"==d&&(d=9e9),f=a.extend({},c.defaults,f),e=e||f.speed||f.duration,f.queue=f.queue&&f.axis.length>1,f.queue&&(e/=2),f.offset=b(f.offset),f.over=b(f.over),this._scrollable().each(function(){function g(a){j.animate(l,e,f.easing,a&&function(){a.call(this,d,f)})}var h,i=this,j=a(i),k=d,l={},m=j.is("html,body");switch(typeof k){case"number":case"string":if(/^([+-]=)?\d+(\.\d+)?(px|%)?$/.test(k)){k=b(k);break}k=a(k,this);case"object":(k.is||k.style)&&(h=(k=a(k)).offset())}a.each(f.axis.split(""),function(a,b){var d="x"==b?"Left":"Top",e=d.toLowerCase(),n="scroll"+d,o=i[n],p=c.max(i,b);if(h)l[n]=h[e]+(m?0:o-j.offset()[e]),f.margin&&(l[n]-=parseInt(k.css("margin"+d))||0,l[n]-=parseInt(k.css("border"+d+"Width"))||0),l[n]+=f.offset[e]||0,f.over[e]&&(l[n]+=k["x"==b?"width":"height"]()*f.over[e]);else{var q=k[e];l[n]=q.slice&&"%"==q.slice(-1)?parseFloat(q)/100*p:q}/^\d+$/.test(l[n])&&(l[n]=l[n]<=0?0:Math.min(l[n],p)),!a&&f.queue&&(o!=l[n]&&g(f.onAfterFirst),delete l[n])}),g(f.onAfter)}).end()},c.max=function(b,c){var d="x"==c?"Width":"Height",e="scroll"+d;if(!a(b).is("html,body"))return b[e]-a(b)[d.toLowerCase()]();var f="client"+d,g=b.ownerDocument.documentElement,h=b.ownerDocument.body;return Math.max(g[e],h[e])-Math.min(g[f],h[f])}}(jQuery),function(a){a.event.special.textchange={setup:function(){a(this).data("lastValue","true"===this.contentEditable?a(this).html():a(this).val()),a(this).bind("keyup.textchange",a.event.special.textchange.handler),a(this).bind("cut.textchange paste.textchange input.textchange",a.event.special.textchange.delayedHandler)},teardown:function(){a(this).unbind(".textchange")},handler:function(){a.event.special.textchange.triggerIfChanged(a(this))},delayedHandler:function(){var b=a(this);setTimeout(function(){a.event.special.textchange.triggerIfChanged(b)},25)},triggerIfChanged:function(a){var b="true"===a[0].contentEditable?a.html():a.val();b!==a.data("lastValue")&&(a.trigger("textchange",[a.data("lastValue")]),a.data("lastValue",b))}},a.event.special.hastext={setup:function(){a(this).bind("textchange",a.event.special.hastext.handler)},teardown:function(){a(this).unbind("textchange",a.event.special.hastext.handler)},handler:function(b,c){""===c&&c!==a(this).val()&&a(this).trigger("hastext")}},a.event.special.notext={setup:function(){a(this).bind("textchange",a.event.special.notext.handler)},teardown:function(){a(this).unbind("textchange",a.event.special.notext.handler)},handler:function(b,c){""===a(this).val()&&a(this).val()!==c&&a(this).trigger("notext")}}}(jQuery),function(a){function b(b,e){a.ajax({url:"/api/company/inn",data:{inn:e},type:"POST",dataType:"json",headers:{"X-API-KEY":"lXIOB4MGR5cgkSYRBxXwaOa4H1FC71IWMwr9C4US"},success:function(e){e.success?(a("input[name=company_type]").val(e.company_type_id),a("input[name=company_type_text]").val(e.company_type_text),a("input[name=company_name]").val(e.company_name),a("input[name=company_name]").prop("disabled",!0),a("input[name=country_id]").val(a(".x-select-country-registratinon option:selected",b).data("country-id")),a("input[name=town]").val(e.town),a("input[name=street]").val(e.street),a("input[name=house]").val(e.house),a("input[name=postal_code]").val(e.postal_code),a("input[name=flat]").val(e.flat),a("input[name=city_type]").val(e.city_type),a("input[name=ogrn]").val(e.ogrn),a("input[name=kpp]").val(e.kpp),a("input[name=boss]").val(e.boss),""!==a("input[name=username]",b).val()&&d.call(this,b),a(".x-input-check-inn",b).removeClass("incorrectly-inn-input")):(a(".x-inn-waring-div").removeClass("warning-inn-input"),c.call(this,b))}})}function c(b){a(".x-auth-save-nick-button",b).attr("disabled","disabled"),a(".x-auth-save-nick-button",b).removeClass("act2"),a("input[name=company_name]").prop("disabled",!1)}function d(b){a(".x-auth-save-nick-button",b).removeAttr("disabled"),a(".x-auth-save-nick-button",b).addClass("act2")}function e(b){a(this).closest("div").toggleClass("ract");var c=a(".x-auth-show-password-input input",b).val();a(this).attr("checked")?(a(this).prop("checked",!1),a(this).attr("checked",!1),a(".x-auth-show-confirm-password-input",b).closest("div.x-auth-input-block").show(),a(".x-auth-show-password-input",b).html('<input id="auth-password" name="password" type="password" class="pustoi1 x-auth-validate" placeholder="Пароль">')):(a(this).prop("checked",!0),a(this).attr("checked",!0),a(".x-auth-show-confirm-password-input",b).closest("div.x-auth-input-block").hide(),a(".x-auth-show-password-input",b).html('<input id="auth-password" name="password" type="text" class="pustoi1 x-auth-validate" placeholder="Пароль">')),a(".x-auth-show-password-input input",b).val(c)}function f(){a(".x-auth-steps").on("click","#email-sugg-yes",function(){var b=a(this).data("full");a("[name=email]").val(b),a(".x-auth-email-sugg-tip").addClass("hidden"),a(".x-auth-status-correct").removeClass("hidden"),a(".x-auth-email-base-tip").removeClass("hidden")}),a(".x-auth-steps").on("click","#email-sugg-no",function(){a(".x-auth-email-sugg-tip").addClass("hidden"),a(".x-auth-status-correct").removeClass("hidden"),a(".x-auth-email-base-tip").removeClass("hidden")})}function g(b,c,d){d.success||(d.success="on-v2"),d.fail||(d.fail="off-v2"),1===c.success?(b.removeClass(d.fail),b.addClass(d.success),c.html?(a(".x-auth-email-base-tip",b).addClass("hidden"),a(".x-auth-status-correct",b).addClass("hidden"),a(".x-auth-email-sugg-tip",b).html(c.html),a(".x-auth-email-sugg-tip",b).removeClass("hidden"),f.call(b)):(a(".x-auth-email-sugg-tip",b).addClass("hidden"),a(".x-auth-status-correct",b).removeClass("hidden"),a(".x-auth-email-base-tip",b).removeClass("hidden"))):0===c.success&&c.message&&(b.removeClass(d.success),b.addClass(d.fail),a(".pustoi6",b).html(c.message),a(".x-auth-email-sugg-tip",b).addClass("hidden"),a(".x-auth-email-base-tip",b).removeClass("hidden"))}function h(b,c,d,e){var f=this;a.ajax({url:"/"+u(b).mainController+"/registration/"+d,data:c,type:"POST",dataType:"json",success:function(c){g(a(f).closest("div.x-auth-input-block"),c,e),1===c.success&&a(".x-auth-save-nick-button",b).removeAttr("disabled")}})}function i(b){var c=a("[name=mobilePhone]").val();a("form",b).ajaxForm({data:{mobilePhone:q(b,c),fieldName:"all"},beforeSubmit:function(){o(),a.blockUI({message:"Подождите..."})},url:"/"+u(b).mainController+"/registration/step0",dataType:"json",success:function(c){var d={success:c.success,message:""};if(0===c.success){for(var e in c.message){var f={};"mobilePhone"==e&&(f={fail:"off-v3"}),d.message=c.message[e],g(a("[name="+e+"]",b).closest("div.x-auth-input-block"),d,f)}a.scrollTo("#x-registration-step0",800),a.unblockUI()}else window.location="/registration/check_the_email?email="+encodeURIComponent(a("[name=email]",b).val().toLowerCase())}})}function j(b,c){a(".x-phone-code-show",b).text("+"+c)}function k(b){var c=a(this).val().length;4==c?(a(".x-auth-activate-phone-button",b).removeClass("no-activ2"),a(".x-auth-activate-phone-button",b).removeAttr("disabled")):(a(".x-auth-activate-phone-button",b).addClass("no-activ2"),a(".x-auth-activate-phone-button",b).attr("disabled","disabled"))}function l(b){var c=a("[name=mobilePhone]",b).val();a("form",b).ajaxForm({data:{mobilePhone:q(b,c)},url:"/"+u(b).mainController+"/activate_phone",dataType:"json",type:"POST",beforeSubmit:function(){a.blockUI({message:"Подождите..."})},success:function(c){var d={success:c.success,message:""};if(1===c.success)g(a(".x-auth-sms-code-input",b).closest("div.x-auth-input-block"),d,{}),window.location="/registration/step2?email="+encodeURIComponent(c.email.toLowerCase())+"&token="+encodeURIComponent(c.token);else if(0===c.success){for(var e in c.message)switch(e){case"SMScode":d.message=c.message[e],c.message[e]?g(a(".x-auth-sms-code-input",b).closest("div.x-auth-input-block"),d,{}):g(a(".x-auth-sms-code-input",b).closest("div.x-auth-input-block"),{success:1},{});break;case"mobilePhone":d.message=c.message[e],g(a("[name=mobilePhone]",b).closest("div.x-auth-input-block"),d,{success:"on-v3",fail:"off-v3"})}a.unblockUI()}else-1===c.success?window.location="/":-2===c.success&&(window.location="/registration/already_a_user")}})}function m(b){a("form",b).ajaxForm({data:{},url:"/"+u(b).mainController+"/update_username",dataType:"json",type:"POST",beforeSend:function(){a.blockUI({message:"Подождите..."})},success:function(c){switch(g(a(".x-auth-username",b).closest("div.x-auth-input-block"),c,{}),c.success){case 1:window.location="/registration/over";break;case-1:window.location="/";break;case-2:window.location="/registration/already_a_user";break;default:a.unblockUI()}}})}function n(b){p.call(b);var c=a("[name=mobilePhone]",b).val();a.ajax({url:"/"+u(b).mainController+"/send_new_sms_activation_code",data:{email:a("#auth-email",b).val(),token:a("#auth-token",b).val(),mobilePhone:q(b,c)},type:"POST",dataType:"json",beforeSend:function(){a.blockUI({message:"Подождите..."})},success:function(c){switch(a.unblockUI(),c.success){case 1:g(a("[name=mobilePhone]",b).closest("div.x-auth-input-block"),c,{success:"on-v3",fail:"off-v3"}),a(".x-auth-send-sms-ok").show(),a(".x-auth-send-sms-ok").fadeOut(1e4);break;case 0:g(a(".x-auth-validate-mobile-phone",b).closest("div.x-auth-input-block"),c,{success:"on-v3",fail:"off-v3"});break;case-2:window.location="/registration/already_a_user";break;default:window.location="/"}}})}function o(){a(".x-auth-input-block").each(function(){a(this).removeClass("on-v2"),a(this).removeClass("on-v3"),a(this).removeClass("off-v2"),a(this).removeClass("off-v3")})}function p(){a(".x-auth-input-block",this).each(function(){a(this).removeClass("on-v2"),a(this).removeClass("on-v3"),a(this).removeClass("off-v2"),a(this).removeClass("off-v3")}),a(".x-auth-sms-code-input",this).val("")}function q(b,c){return"+"+a(".x-auth-select-country-flag option:selected",b).data("phone-code")+c}function r(b){var c=this,d=a(c).data("number"),e=0;a(c).closest(".x-auth-role-block").toggleClass("click"),a(c).prop("checked",!0),a(c).checked=!0,a(".x-auth-role-block input[type=checkbox]").each(function(){a(this).data("number")!=d&&(a(this).closest(".x-auth-role-block").removeClass("click"),a(this).prop("checked",!1),a(this).checked=!1)}),a(".x-auth-role-block",b).each(function(){a(this).hasClass("click")&&e++}),e>0?(a(".x-auth-set-role-button",b).addClass("act2"),a(".x-auth-set-role-button",b).removeAttr("disabled")):(a(".x-auth-set-role-button",b).removeClass("act2"),a(".x-auth-set-role-button",b).attr("disabled","disabled"))}function s(b){a("form",b).ajaxForm({data:{},beforeSubmit:function(){a.blockUI({message:"Подождите..."})},url:"/"+u(b).mainController+"/set_user_role",dataType:"json",type:"POST",success:function(b){switch(b.success){case 1:window.location="/registration/step21?email="+encodeURIComponent(b.email.toLowerCase())+"&token="+encodeURIComponent(b.token);break;case-2:window.location="/registration/already_a_user";break;default:a.unblockUI()}}})}function t(b){var c=b.target.value;c=c.replace(/[^0-9]/g,"").substr(0,17),a(this).val(c)}function u(b){return a.data(b,"vvAuthSteps")}a.vvAuthSteps={defaults:{mainController:"authv3"}},a.fn.extend({vvAuthSteps:function(f){return this.each(function(){f=a.extend({},a.vvAuthSteps.defaults,f),a.data(this,"vvAuthSteps",f);var g=this,o=1e3,p=[];a(".x-auth-show-password",g).on("click",function(){e.call(this,g)}),a(".x-auth-select-country-flag",g).msDropDown(),a(".x-auth-select-country-flag",g).on("change",function(){a(".x-country-id").val(a("option:selected",this).data("id")),j.call(this,g,a("option:selected",this).attr("data-phone-code"))}),a(".x-company-organization-type",g).on("change",function(){a("input[name=company_type]").val(a(this).val())}),a("[name=mobilePhone]",g).on("input",function(a){t.call(this,a)}),a(".x-auth-validate",g).on("textchange",function(){var b=this,c=a(this).attr("name");p[c]&&clearTimeout(p[c]);var d={},e={};p[c]=setTimeout(function(){if(d[c]=a(b).val(),d.fieldName=c,"mobilePhone"==c&&(d[c]=q(g,a(b).val()),e={success:"on-v3",fail:"off-v3"}),a(b).data("related-name")){var f=a(b).data("related-name");d[f]=a("[name="+f+"]",g).val()}h.call(b,g,d,"step0",e)},o)}),a(".x-registration-button",g).on("click",function(){i.call(this,g)}),a(".x-auth-select-country-flag",g).msDropDown(),a(".x-auth-sms-code-input",g).on("input",function(){k.call(this,g)}),a(".x-auth-activate-phone-button",g).on("click",function(){l.call(this,g)}),a(".x-auth-send-new-sms-code",g).on("click",function(){n.call(this,g)}),a(".x-auth-role",g).on("click",function(){r.call(this,g)}),a(".x-auth-set-role-button",g).on("click",function(){s.call(this,g)}),a(".x-auth-save-nick-button",g).on("click",function(){m.call(this,g)}),a(".x-select-citizenship",g).on("change",function(){a("input[name=citizenship_id]").val(a("option:selected",this).data("id"))}),a("input[name=country_id]").val(a(".x-select-country-registratinon option:selected",g).data("country-id")),a("input[name=country_name]").val(a(".x-select-country-registratinon option:selected",g).val()),a(".x-select-country-registratinon",g).on("change",function(){a("input[name=country_id]").val(a(".x-select-country-registratinon option:selected",g).data("country-id")),a("input[name=country_name]").val(a(".x-select-country-registratinon option:selected",g).val()),a("input[name=company_type_text]").val(""),a("input[name=company_name]").val(""),a("input[name=vat]").val(""),a("input[name=town]").val(""),a("input[name=street]").val(""),a("input[name=house]").val(""),a("input[name=postal_code]").val(""),a("input[name=flat]").val(""),a("input[name=city_type]").val(),a("input[name=kpp]").val(),a("input[name=ogrn]").val(),a("input[name=boss]").val(),a(".x-inn-waring-div").hasClass("warning-inn-input")||a(".x-inn-waring-div").addClass("warning-inn-input"),a(".x-input-check-inn",g).hasClass("incorrectly-inn-input")&&a(".x-input-check-inn",g).removeClass("incorrectly-inn-input"),"Россия"!=a(".x-select-country-registratinon",g).val()?(a("input[name=company_type]").val("3"),a(".x-opf-input",g).hide(),a(".x-opf-select",g).hide(),a(".x-opf-name",g).hide()):(a("input[name=company_type]").val(""),a(".x-opf-input",g).show(),a(".x-opf-name",g).show(),a(".x-opf-select",g).hide())}),c.call(this,g),a(".x-select-country-registratinon,.x-select-citizenship,input[name=company_name] ,input[name=username],input[name=vat],input[name=company_type_text]",g).on("textchange change",function(){c.call(this,g),"legal_carrier"===a("input[name=carrier_type]",g).val()?"Россия"!=a(".x-select-country-registratinon").val()?""===a("input[name=company_name]").val()||""===a("input[name=username]",g).val()||""===a("input[name=vat]").val()?c.call(this,g):d.call(this,g):""===a("input[name=company_name]").val()||""===a("input[name=username]",g).val()||""===a("input[name=vat]").val()||""===a("input[name=company_type]").val()?c.call(this,g):d.call(this,g):d.call(this,g)}),a(".x-input",g).on("focus",function(){var b=a(this).data("tip");a(".x-tip[data-tip="+b+"]").addClass("show")}).on("blur",function(){var b=a(this).data("tip");a(".x-tip[data-tip="+b+"]").removeClass("show")}),a(".x-input-check-inn",g).on("input",function(){if("legal_carrier"===a("input[name=carrier_type]",g).val()&&(a(".x-inn-waring-div").addClass("warning-inn-input"),"Россия"==a(".x-select-country-registratinon",g).val())){a(".x-input-check-inn",g).addClass("incorrectly-inn-input"),a("input[name=company_type]").val(""),a("input[name=company_type_text]").val(""),a("input[name=company_name]").val(""),a("input[name=town]").val(""),a("input[name=street]").val(""),a("input[name=house]").val(""),a("input[name=postal_code]").val(""),a("input[name=flat]").val(""),a("input[name=city_type]").val(),a("input[name=kpp]").val(),a("input[name=ogrn]").val(),a("input[name=boss]").val();var d=a(".x-input-check-inn").val(),e=d.length,f=a.isNumeric(d)&&(10==e||12==e);f?"1111111111"==d||"111111111111"==d?(a(".x-opf-input",g).hide(),a(".x-opf-select",g).show(),a("input[name=company_type]").val(a("select[name=company_type_text]",g).val())):(a(".x-opf-input",g).show(),a(".x-opf-select",g).hide(),b.call(this,g,d)):(a(".x-opf-input",g).show(),a(".x-opf-select",g).hide(),a(".x-input-check-inn",g).addClass("incorrectly-inn-input"),c.call(this,g))}})})}})}(jQuery),$(document).ready(function(){$(".x-auth-steps").vvAuthSteps(),$(".x-ac2").vvAutocomplete({clearCountryDirectly:!0})});